<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Crypto Alerts Bot Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Inter', sans-serif;
  background: #0f111a;
  color: #fff;
  margin: 0;
  padding: 20px;
}
h1 { text-align:center; margin-bottom:20px; }
.vip-status { display:inline-block; padding:6px 12px; border-radius:20px; font-weight:600; margin-bottom:20px; }
.vip-status.vip { background: linear-gradient(90deg,#f9d423,#ff4e50); color:#000; }
.vip-status.free { background:#444; color:#fff; }

.section { margin-bottom: 20px; }
.section h3 {
  cursor: pointer;
  background:#1f2233; padding:10px 15px; border-radius:10px;
  display:flex; justify-content:space-between; align-items:center;
}
.section ul {
  list-style:none; padding:0; margin:0; display:none;
  max-height:300px; overflow-y:auto;
}
.section ul li {
  background:#272b40; padding:10px 15px; border-radius:10px; margin:5px 0;
  display:flex; justify-content:space-between;
}
.badge { padding:2px 8px; border-radius:8px; font-size:12px; font-weight:600; color:#fff; }
.badge.signal { background:#ff4e50; }
.badge.meme { background:#f9d423; color:#000; }
.badge.alpha { background:#4ecca3; }
.badge.event { background:#00aaff; }

button { padding:10px 16px; border:none; border-radius:10px; cursor:pointer; font-weight:600; background:#ff4e50; color:#fff; transition:all 0.2s; }
button:hover { background:#f9d423; color:#000; }

.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.7); z-index:1000; }
.modal-content { background:#1f2233; padding:30px; margin:100px auto; width:300px; border-radius:15px; text-align:center; box-shadow:0 0 20px rgba(0,0,0,0.6); }
.modal-content input { width:100%; padding:10px; margin-bottom:15px; border-radius:10px; border:none; outline:none; background:#0f111a; color:#fff; }
</style>
</head>
<body>

<h1>Crypto Alerts Bot</h1>
<div class="vip-status vip" id="vipStatus">VIP User</div>

<div class="section" id="alertsSection">
  <h3>My Alerts <span>▼</span></h3>
  <ul id="alertsList"></ul>
</div>

<div class="section" id="signalsSection">
  <h3>High-Signal Alerts <span>▼</span></h3>
  <ul id="signalsList"></ul>
</div>

<div class="section" id="memesSection">
  <h3>MemeCoin Hype <span>▼</span></h3>
  <ul id="memesList"></ul>
</div>

<div class="section" id="alphaSection">
  <h3>Alpha Feed <span>▼</span></h3>
  <ul id="alphaList"></ul>
</div>

<div class="section" id="eventsSection">
  <h3>Upcoming Events & Airdrops <span>▼</span></h3>
  <ul id="eventsList"></ul>
</div>

<button onclick="openModal()">+ Create Alert</button>

<!-- Modal -->
<div class="modal" id="alertModal">
  <div class="modal-content">
    <h3>Create Alert</h3>
    <input id="coin" placeholder="Coin (e.g., bitcoin)">
    <input id="type" placeholder="Type (Above/Below)">
    <input id="target" placeholder="Target Price">
    <button onclick="createAlert()">Save</button>
    <button style="margin-top:10px; background:#555; color:#fff;" onclick="closeModal()">Cancel</button>
  </div>
</div>

<script>
async function loadDashboard() {
  const userId = 'demo-user';

  const alerts = await (await fetch('/alert', { headers:{ 'x-user-id': userId }})).json();
  document.getElementById('alertsList').innerHTML = alerts.map(a => `<li>${a.coin} ${a.type} $${a.target}</li>`).join('');

  const signals = (await (await fetch('/signals')).json()).signals || [];
  document.getElementById('signalsList').innerHTML = signals.map(s => `<li><span class="badge signal">Signal</span> ${s.channel}: ${s.message}</li>`).join('');

  const memes = (await (await fetch('/memeradar')).json()).topCoins || [];
  document.getElementById('memesList').innerHTML = memes.map(m => `<li><span class="badge meme">Meme</span> ${m.name||m.symbol.toUpperCase()} – ${m.price_change_percentage_24h?.toFixed(2)}%</li>`).join('');

  const alpha = (await (await fetch('/alphafeed')).json()).alphaFeed || [];
  document.getElementById('alphaList').innerHTML = alpha.map(a => `<li><span class="badge alpha">Alpha</span> ${a.trader}: ${a.insight} (Watchlist: ${a.watchlist.join(', ')})</li>`).join('');

  const events = (await (await fetch('/events')).json()).events || [];
  document.getElementById('eventsList').innerHTML = events.map(e => `<li><span class="badge event">Event</span> ${e.event} – ${e.date}</li>`).join('');
}
loadDashboard();

// Collapsible sections
document.querySelectorAll('.section h3').forEach(h3 => {
  h3.addEventListener('click', () => {
    const ul = h3.nextElementSibling;
    ul.style.display = (ul.style.display==='block') ? 'none' : 'block';
    h3.querySelector('span').textContent = (ul.style.display==='block') ? '▲' : '▼';
  });
});

function openModal() { document.getElementById('alertModal').style.display='block'; }
function closeModal() { document.getElementById('alertModal').style.display='none'; }

async function createAlert() {
  const coin = document.getElementById('coin').value;
  const type = document.getElementById('type').value;
  const target = document.getElementById('target').value;
  if(!coin||!type||!target){ alert('Fill all fields!'); return; }
  await fetch('/alert',{ method:'POST', headers:{ 'x-user-id':'demo-user','Content-Type':'application/json' }, body:JSON.stringify({coin,type,target})});
  alert('Alert created!'); closeModal(); loadDashboard();
}
</script>
</body>
</html>
